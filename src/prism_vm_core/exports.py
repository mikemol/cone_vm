"""Single control surface for prism_vm exports."""

import importlib

from prism_vm_core import facade as _facade
from prism_vm_core import types as _types

_repl = importlib.import_module("prism_cli.repl")

__all__ = [
    "OP_NULL",
    "OP_ZERO",
    "OP_SUC",
    "OP_ADD",
    "OP_MUL",
    "OP_SORT",
    "OP_COORD_ZERO",
    "OP_COORD_ONE",
    "OP_COORD_PAIR",
    "ZERO_PTR",
    "OP_NAMES",
    "ManifestPtr",
    "LedgerId",
    "ArenaPtr",
    "HostInt",
    "HostBool",
    "ProvisionalIds",
    "CommittedIds",
    "QMap",
    "MAX_ROWS",
    "MAX_KEY_NODES",
    "LEDGER_CAPACITY",
    "MAX_ID",
    "MAX_COUNT",
    "MAX_COORD_STEPS",
    "InternConfig",
    "DEFAULT_INTERN_CONFIG",
    "AllocConfig",
    "DEFAULT_ALLOC_CONFIG",
    "Cnf2Flags",
    "DEFAULT_CNF2_FLAGS",
    "Cnf2Config",
    "DEFAULT_CNF2_CONFIG",
    "ArenaInteractConfig",
    "DEFAULT_ARENA_INTERACT_CONFIG",
    "ArenaCycleConfig",
    "DEFAULT_ARENA_CYCLE_CONFIG",
    "arena_interact_config_with_policy",
    "arena_interact_config_with_policy_value",
    "arena_interact_config_with_guard",
    "arena_cycle_config_with_policy",
    "arena_cycle_config_with_policy_value",
    "arena_cycle_config_with_guard",
    "cnf2_config_with_policy",
    "cnf2_config_with_policy_value",
    "cnf2_config_with_guard",
    "IntrinsicConfig",
    "DEFAULT_INTRINSIC_CONFIG",
    "CoordConfig",
    "DEFAULT_COORD_CONFIG",
    "GuardConfig",
    "DEFAULT_GUARD_CONFIG",
    "SafetyPolicy",
    "DEFAULT_SAFETY_POLICY",
    "PolicyValue",
    "POLICY_VALUE_CORRUPT",
    "POLICY_VALUE_CLAMP",
    "POLICY_VALUE_DROP",
    "policy_to_value",
    "oob_mask",
    "oob_mask_value",
    "oob_any_value",
    "_TEST_GUARDS",
    "_HAS_DEBUG_CALLBACK",
    "_SCATTER_GUARD",
    "_GATHER_GUARD",
    "_scatter_guard",
    "_scatter_guard_strict",
    "_scatter_drop",
    "_scatter_strict",
    "guards_enabled_cfg",
    "guard_max_cfg",
    "guard_gather_index_cfg",
    "make_safe_gather_fn",
    "make_safe_gather_ok_fn",
    "make_safe_index_fn",
    "make_safe_gather_value_fn",
    "make_safe_gather_ok_value_fn",
    "make_safe_index_value_fn",
    "resolve_safe_gather_fn",
    "resolve_safe_gather_ok_fn",
    "resolve_safe_index_fn",
    "resolve_safe_gather_value_fn",
    "resolve_safe_gather_ok_value_fn",
    "resolve_safe_index_value_fn",
    "guard_slot0_perm_cfg",
    "guard_null_row_cfg",
    "guard_zero_row_cfg",
    "guard_zero_args_cfg",
    "guard_swizzle_args_cfg",
    "_key_order_commutative_host",
    "_cnf2_enabled",
    "_cnf2_slot1_enabled",
    "_default_bsp_mode",
    "_normalize_bsp_mode",
    "_parse_milestone_value",
    "_read_pytest_milestone",
    "_servo_enabled",
    "_gpu_metrics_enabled",
    "_gpu_metrics_device_index",
    "safe_gather_1d",
    "safe_gather_1d_ok",
    "safe_gather_1d_cfg",
    "safe_gather_1d_ok_cfg",
    "safe_index_1d",
    "safe_index_1d_cfg",
    "coord_norm_probe_reset",
    "coord_norm_probe_get",
    "_coord_leaf_id",
    "_coord_promote_leaf",
    "_damage_metrics_enabled",
    "_damage_metrics_update",
    "_damage_tile_size",
    "damage_metrics_reset",
    "cnf2_metrics_reset",
    "damage_metrics_get",
    "cnf2_metrics_get",
    "GPUWatchdog",
    "_gpu_watchdog_create",
    "RANK_HOT",
    "RANK_WARM",
    "RANK_COLD",
    "RANK_FREE",
    "Manifest",
    "Arena",
    "Ledger",
    "CandidateBuffer",
    "CompactResult",
    "CompactConfig",
    "DEFAULT_COMPACT_CONFIG",
    "NodeBatch",
    "_candidate_indices",
    "candidate_indices_cfg",
    "_pack_key",
    "_scatter_compacted_ids",
    "scatter_compacted_ids_cfg",
    "_invert_perm",
    "_lookup_node_id",
    "_arena_ptr",
    "_committed_ids",
    "_host_bool",
    "_host_bool_value",
    "_host_int",
    "_host_int_value",
    "_host_raise_if_bad",
    "_ledger_id",
    "_manifest_ptr",
    "_provisional_ids",
    "_require_arena_ptr",
    "_require_ledger_id",
    "_require_manifest_ptr",
    "_require_ptr_domain",
    "Stratum",
    "StagingContext",
    "hyperstrata_precedes",
    "staging_context_forgets_detail",
    "node_batch",
    "init_manifest",
    "init_arena",
    "init_ledger",
    "ledger_has_corrupt",
    "project_manifest_to_ledger",
    "project_arena_to_ledger",
    "_ledger_root_hash_host",
    "_ledger_roots_hash_host",
    "emit_candidates",
    "emit_candidates_cfg",
    "emit_candidates_jit",
    "emit_candidates_jit_cfg",
    "compact_candidates_jit",
    "compact_candidates_jit_cfg",
    "compact_candidates_result_jit",
    "compact_candidates_result_jit_cfg",
    "compact_candidates_with_index_jit",
    "compact_candidates_with_index_jit_cfg",
    "compact_candidates_with_index_result_jit",
    "compact_candidates_with_index_result_jit_cfg",
    "intern_candidates_jit",
    "intern_candidates_jit_cfg",
    "cycle_candidates_jit",
    "compact_candidates",
    "compact_candidates_result",
    "compact_candidates_cfg",
    "compact_candidates_with_index",
    "compact_candidates_with_index_result",
    "compact_candidates_with_index_cfg",
    "DEFAULT_COMPACT_CONFIG",
    "intern_candidates",
    "intern_candidates_cfg",
    "validate_stratum_no_within_refs_jax",
    "validate_stratum_no_within_refs",
    "validate_stratum_no_future_refs_jax",
    "validate_stratum_no_future_refs",
    "apply_q",
    "commit_stratum",
    "cycle_candidates",
    "op_rank",
    "coord_norm",
    "coord_xor",
    "coord_xor_cfg",
    "cd_lift_binary",
    "cd_lift_binary_cfg",
    "coord_norm_batch",
    "coord_norm_batch_jit",
    "coord_xor_batch",
    "coord_xor_batch_cfg",
    "intern_nodes",
    "intern_nodes_jit",
    "op_sort_and_swizzle_with_perm",
    "op_sort_with_perm_cfg",
    "op_sort_and_swizzle",
    "op_sort_and_swizzle_blocked_with_perm",
    "op_sort_blocked_with_perm_cfg",
    "op_sort_and_swizzle_blocked",
    "_blocked_perm",
    "op_sort_and_swizzle_hierarchical_with_perm",
    "op_sort_hierarchical_with_perm_cfg",
    "op_sort_and_swizzle_hierarchical",
    "swizzle_2to1_host",
    "swizzle_2to1_dev",
    "swizzle_2to1",
    "op_morton",
    "op_sort_and_swizzle_morton_with_perm",
    "op_sort_morton_with_perm_cfg",
    "op_sort_and_swizzle_morton",
    "op_sort_and_swizzle_servo_with_perm",
    "op_sort_servo_with_perm_cfg",
    "op_sort_and_swizzle_servo",
    "_servo_update",
    "_blind_spectral_probe",
    "_servo_mask_from_k",
    "_servo_mask_to_k",
    "op_interact",
    "op_interact_value",
    "op_interact_cfg",
    "op_interact_jit",
    "op_interact_jit_cfg",
    "op_interact_value_jit",
    "cycle_intrinsic",
    "cycle_intrinsic_cfg",
    "cycle_intrinsic_jit",
    "cycle_intrinsic_jit_cfg",
    "cycle",
    "cycle_value",
    "cycle_cfg",
    "cycle_jit",
    "cycle_jit_cfg",
    "cycle_value_jit",
    "cycle_core",
    "kernel_add",
    "kernel_mul",
    "optimize_ptr",
    "dispatch_kernel",
    "PrismVM",
    "PrismVM_BSP_Legacy",
    "PrismVM_BSP",
    "make_vm",
    "run_program_lines",
    "run_program_lines_arena",
    "run_program_lines_bsp",
    "repl",
]


def _export_lookup(name: str):
    if hasattr(_facade, name):
        return getattr(_facade, name)
    if hasattr(_types, name):
        return getattr(_types, name)
    if hasattr(_repl, name):
        return getattr(_repl, name)
    raise AttributeError(f"prism_vm export missing: {name}")


for _name in __all__:
    globals()[_name] = _export_lookup(_name)
