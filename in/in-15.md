This note formalizes **milestone-gated testing** and the **VS Code workflow**
for selecting a milestone in the Testing panel. It complements the acceptance
gates in the implementation plan by making the gate mechanical and repeatable.

---

## 1) The intent

We do not rely on xfail to tell us "what should fail." Instead:

- Each test is tagged with the *earliest* milestone at which it must pass.
- A milestone gate skips tests that are beyond the selected milestone.
- Within the selected milestone, every test is expected to pass.

This keeps expectations explicit, avoids test flakiness, and forces the
plan's acceptance criteria to be executable.

---

## 2) The mechanism (pytest)

We use:

- Markers: `m1`, `m2`, `m3`, `m4`, `m5`
- A gate in `conftest.py` that skips tests above the selected milestone
- Per-milestone pytest configs: `pytest.m1.ini` .. `pytest.m5.ini`

Example:

- `pytest -c pytest.m2.ini` runs only tests marked `m1` or `m2`
- `pytest -c pytest.m4.ini` runs `m1`..`m4`, and skips `m5`

This matches the plan's "acceptance gates" directly.

---

## 3) VS Code integration (single toggle, Option A)

VS Code's Testing panel only shows what pytest discovers. We make milestone
selection deterministic by feeding pytest a milestone-specific config and
reading the milestone from an env file.

Workflow:

1) Edit `.vscode/pytest.env`:

```
PRISM_MILESTONE=m2
```

2) Refresh tests in VS Code:

- "Testing: Refresh Tests"

3) The Testing panel now shows only tests <= the milestone.

Under the hood:

- `python.testing.pytestArgs` uses:
  `-c pytest.${env:PRISM_MILESTONE}.ini`
- `python.testing.envFile` points at `.vscode/pytest.env`

This makes VS Code's test list mirror the milestone gate, without a manual
command line step.

---

## 4) The contract this enforces

At any milestone:

- All tests *at or below* the milestone are expected to pass.
- Tests beyond the milestone are skipped by the gate.
- No xfail guards are used to "bless failures."

This makes the milestone gate a formal contract, not a convenience flag.

---

## 5) Why this matters

The plan is explicit about acceptance gates (M1, M2, M3, M4). This testing
layout makes those gates:

- Visible in the IDE
- Reproducible on CLI
- Enforced by default

As a result, "milestone complete" becomes a testable, tool-supported state.

---

## 6) Quick reference

CLI:

- `pytest -c pytest.m1.ini`
- `pytest -c pytest.m2.ini`
- `pytest -c pytest.m3.ini`
- `pytest -c pytest.m4.ini`
- `pytest -c pytest.m5.ini`

VS Code:

- edit `.vscode/pytest.env`
- refresh tests

---

If we later want multiple milestones in the UI at once, a multi-root workspace
can be added (Option B). For now, the single env toggle keeps the workflow
simple and deterministic.
